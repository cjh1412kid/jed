<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>首页</title>
    <link rel="stylesheet" type="text/css" href="../css/aui2x1/aui.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui1x2x1/aui_iconfont.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui2x1/aui_slide.css" />
    <link rel="stylesheet" type="text/css" href="../css/common/style.css" />
    <link rel="stylesheet" type="text/css" href="../css/tab_content_1.css" />
    <link rel="stylesheet" type="text/css" href="../css/swiper_min.css" />
    <style type="text/css">

    </style>
</head>

<body>
    <!-- <img src="../image/bg_user.png" alt="" class="bgdom"> -->
    <header class="aui-bar aui-bar-nav aui-bar-light">
        <div class="aui-pull-left aui-btn aui-hide">
            <span class="aui-iconfont aui-icon-left aui-text-default"></span>
        </div>
        <div class="aui-title" style="left:0.0rem; right: 2.0rem;">
            <div class="aui-searchbar">
                <div class="aui-searchbar-input aui-border-radius" tapmode onclick="openSearchWin()">
                    <i class="aui-iconfont aui-icon-search aui-font-size-14"></i>
                    <input class="aui-font-size-12" type="search" placeholder="请输入搜索内容" id="search-input" disabled="">
                    <div class="aui-searchbar-clear-btn">
                        <i class="aui-iconfont aui-icon-close"></i>
                    </div>
                </div>
                <div class="aui-searchbar-btn" tapmode>取消</div>
            </div>
        </div>
        <a class="aui-pull-right aui-btn aui-margin-r-5" tapmode onclick="openScanner()"><img src="../image/icon_scanner.png" /></a>
    </header>
    <div class="content aui-padded-b-5 aui-hide">
        <div class="poster-area">
            <div id="aui-slide1" class="aui-bg-white aui-padded-10">
                <div class="aui-slide-wrap">
                    <!-- <div class='aui-slide-node bg-dark' data-title='公告二' data-link-type='-1' data-link-seq='' tapmode onclick='openAllShoesList(this)'><img src='../image/load_nine_five' data-src='http://221.229.214.60:8181/jed-picture/notice/3/1553760652956.png' /></div>
                    <div class='aui-slide-node bg-dark' data-title='大众平底,进口真皮革,国产仿皮革' data-link-type='2' data-link-seq='27,28,24' tapmode
                        onclick='openAllShoesList(this)'><img src='../image/load_nine_five' data-src='http://221.229.214.60:8181/jed-picture/sr_base/sowing/4/f079500e_ed08_4e22_9593_737650a93c1b.png' /></div>
                    <div class='aui-slide-node bg-dark' data-title='棉鞋' data-link-type='2' data-link-seq='7'
                        tapmode onclick='openAllShoesList(this)'><img src='../image/load_nine_five' data-src='http://221.229.214.60:8181/jed-picture/sr_base/sowing/4/6e9e5cea_e9f3_4138_b655_73ce204e494b.png' /></div>
                    <div class='aui-slide-node bg-dark' data-title='' data-link-type='1' data-link-seq='3'
                        tapmode onclick='openAllShoesList(this)'><img src='../image/load_nine_five' data-src='http://221.229.214.60:8181/jed-picture/sr_base/sowing/4/ce18c2c2_299b_4003_9b71_d78dcb5a558a.png' /></div>
                    <div class='aui-slide-node bg-dark' data-title='' data-link-type='1' data-link-seq='4,5'
                        tapmode onclick='openAllShoesList(this)'><img src='../image/load_nine_five' data-src='http://221.229.214.60:8181/jed-picture/sr_base/sowing/4/577c3972_1723_491e_ba2e_575a1507cd5b.png' /></div>
                    <div class='aui-slide-node bg-dark' data-title='2018春季,2018夏季' data-link-type='3'
                        data-link-seq='3,4' tapmode onclick='openAllShoesList(this)'><img src='../image/load_nine_five' data-src='http://221.229.214.60:8181/jed-picture/sr_base/sowing/4/4e579377_fd41_4d12_b3f1_b2e20715eb14.png' /></div> -->
                </div>
                <div class="aui-slide-page-wrap"></div>
            </div>
        </div>
        <section class="aui-grid my-grid">
            <div class="aui-row">
                <!-- <div class="aui-col-xs-3" tapmode onclick="toGoodsListWin(0,1,'-1', '新品推荐')">
                    <img src="../image/icon_xptj2.png" />
                    <div class="aui-grid-label aui-font-size-12">
                        新品推荐
                    </div>
                </div>
                <div class="aui-col-xs-3" tapmode onclick="toGoodsListWin(0,2,'-1', '公司主推')">
                    <img src="../image/icon_gszt2.png" />
                    <div class='aui-badge unread-order aui-hide' id="rongUnreadMessageCount">1</div>
                    <div class="aui-grid-label aui-font-size-12">
                        公司主推
                    </div>
                </div>
                <div class="aui-col-xs-3 shop-goods" tapmode onclick="toGoodsListWin(1,0,'-1', '本店货品')">
                    <img src="../image/icon_bdhp2.png" />
                    <div class="aui-grid-label aui-font-size-12">
                        本店货品
                    </div>
                </div>
                <div class="aui-col-xs-3" tapmode onclick="toGoodsListWin(0,0,'-1', '全部货品')">
                    <img src="../image/icon_qbsp2.png" />
                    <div class="aui-grid-label aui-font-size-12">
                        全部货品
                    </div>
                </div>
                <div class="aui-col-xs-3" tapmode onclick="toGoodsListWin(0,0,'-1', '畅销款')">
                    <img src="../image/icon_qbsp2.png" />
                    <div class="aui-grid-label aui-font-size-12">
                        畅销款
                    </div>
                </div>
                <div class="aui-col-xs-3 aui-hide" tapmode onclick="openCategoryWin()">
                    <img src="../image/icon_fl.png" />
                    <div class="aui-grid-label aui-font-size-12">
                        分类
                    </div>
                </div>
                <div class="aui-col-xs-3" tapmode onclick="openOrderMetting()">
                    <img src="../image/icon_dhh2.png" />
                    <div class="aui-grid-label aui-font-size-12">
                        订货会
                    </div>
                </div>
                <div class="aui-col-xs-3" tapmode onclick="toSaleAnalysis()">
                    <img src="../image/icon_xsfx2.png" />
                    <div class="aui-grid-label aui-font-size-12">
                        销售分析
                    </div>
                </div>
                <div class="aui-col-xs-3" tapmode onclick="toReplenishment()">
                    <img src="../image/icon_bhdt2.png" />
                    <div class="aui-grid-label aui-font-size-12">
                        补货动态
                    </div>
                </div>
                <div class="aui-col-xs-3" tapmode onclick="_openWin('manage_win','manage_win.html')">
                    <img src="../image/icon_mdzt2.png" />
                    <div class='aui-badge unread-order aui-hide' id="rongUnreadMessageCount">1</div>
                    <div class="aui-grid-label aui-font-size-12">
                        更多
                    </div>
                </div> -->
            </div>
        </section>
        <section class="layout-default">
            <div class="company-recommend">
                <div class="category-name gszt flex-wrap" tapmode onclick="toGoodsListWin(0,0, '-1','主推款')">
                    主推款
                    <div class="flex-con flex-wrap flex-vertical aui-margin-l-10 aui-margin-r-5">
                        <div class="flex-con"></div>
                        <div class="flex-con"></div>
                    </div>
                    <div class="title-tips box-wrap box-vertical-end box-horizontal-center">
                        更多<i class="aui-iconfont aui-icon-right aui-collapse-arrow"></i>
                    </div>
                </div>

                <!-- <div id="aui-slide2" class="aui-margin-r-10 aui-margin-l-10"> -->
                <!-- <div class="aui-slide-wrap"> -->
                <!--<div class="aui-slide-node bg-dark" tapmode onclick="toGoodsDetailWin();">
                                <img src="../image/img_slide_1.png" />
                            </div>
                            <div class="aui-slide-node bg-dark" tapmode onclick="toGoodsDetailWin();">
                                <img src="../image/img_slide_2.png" />
                            </div>-->
                <!-- </div> -->
                <!-- <div class="aui-slide-page-wrap"> -->
                <!-- </div> -->
                <div class="mainly-dom swiper-container" id="wrapper">
                    <ul id="scroller" class="swiper-wrapper">

                    </ul>
                </div>
            </div>
    </div>
    <div class="new-recommend">
        <div class="category-name flex-wrap" tapmode onclick="toGoodsListWin(0,1,'-1', '新品推荐')">
            新品推荐
            <div class="flex-con flex-wrap flex-vertical aui-margin-l-10 aui-margin-r-5">
                <div class="flex-con"></div>
                <div class="flex-con"></div>
            </div>
            <div class="title-tips box-wrap box-vertical-end box-horizontal-center">
                更多<i class="aui-iconfont aui-icon-right aui-collapse-arrow aui-font-size-10"></i>
            </div>
        </div>
        <div class="aui-content aui-margin-r-10 aui-margin-l-10" style="background-color: #fff;">
            <div class="aui-row new-goods">
                <!--<div class='aui-hide aui-col-xs-4 box-wrap box-horizontal-center box-vertical-center' tapmode onclick='toGoodsDetailWin(this)'>
                                <img src='../image/goods/B7132667C19.jpg'/>
                                <div class='NO aui-hide'>
                                    NO.1
                                </div>
                            </div>
                            <div class="aui-hide aui-col-xs-4 box-wrap box-horizontal-center box-vertical-center new-1" tapmode onclick="toGoodsDetailWin()">
                                <img src="../image/goods/B7571917A09.jpg"/>
                                <div class="NO aui-hide">
                                    NO.2
                                </div>
                            </div>-->
            </div>
        </div>
    </div>
    <div class="all-recommend">
        <div class="category-name flex-wrap" tapmode onclick="toGoodsListWin(0,0, '-1','全部货品')">
            全部货品
            <div class="flex-con flex-wrap flex-vertical aui-margin-l-10 aui-margin-r-5">
                <div class="flex-con"></div>
                <div class="flex-con"></div>
            </div>
            <div class="title-tips box-wrap box-vertical-end box-horizontal-center">
                更多<i class="aui-iconfont aui-icon-right aui-collapse-arrow"></i>
            </div>
        </div>
        <div class="aui-grid">
            <!-- <div class="aui-row">
                        <div class="aui-col-xs-6 aui-border-r aui-padded-0" tapmode onclick="toGoodsDetailWin()">
                            <div class='contain'>
                                <div class='item'>
                                    <div class='box'><img src='http://192.168.2.186:8080/picture/sr_base/Goods_Shoes/123/09c774e8_0e43_4954_947a_14de151af318.jpg' /></div>
                                </div>
                            </div>
                            <div class="goods-title aui-text-left aui-padded-l-5 aui-padded-r-5">
                                依婷公主女鞋2018新款品牌刺绣透气浅口休闲平底内增高百搭小白鞋,皮质真皮
                            </div>
                            <div class="goods-price flex-wrap aui-text-left aui-text-theme aui-padded-l-5">
                                <div class="flex-2"><span class="price-name aui-font-size-12">￥</span><span class="price-value-left aui-font-size-18">689</span><span class="price-value-right aui-font-size-12">.00</span></div>
                                <div class="flex-con attr-name">评分 8.2</div>
                            </div>
                            <div class="goods-attr aui-text-left flex-wrap aui-padded-l-5 aui-padded-r-5">
                                <span class="attr-name">货号：</span><span class="attr-value">3960-013AEB</span>
                            </div>
                            <div class="goods-attr flex-wrap aui-padded-l-5 aui-padded-r-5 aui-margin-b-5">
                                <div class="aui-margin-r-15">
                                    <span class="attr-name">已订：</span><span class="attr-value">3</span>
                                </div>
                                <div class="">
                                    <span class="attr-name">库存：</span><span class="attr-value">90</span>
                                </div>
                            </div>
                        </div>
                    </div> -->
        </div>
    </div>
    </section>
    <section class="layout-custom aui-margin-t-10 aui-hide">
        <!--<div>
                    <video class="edui-upload-video video-js vjs-default-skin video-js" controls="controls" webkit-playsinline="" playsinline="" x5-playsinline="" preload="meta" width="100%" height="auto" src="https://www.fyweather.com/SmartSale/picture\ueditor\4\video\eb1afbad_4c8b_40bc_9909_c1e679df0289.mp4">
                        <source src="https://www.fyweather.com/SmartSale/picture\ueditor\4\video\eb1afbad_4c8b_40bc_9909_c1e679df0289.mp4" type="video/mp4" >
                    </video>
                </div>
                <img src="https://www.fyweather.com/SmartSale/picture/ueditor/4/image/beee07cd_82a7_46b7_bff4_330b7a22db60.jpg" width="100%" height="auto" title="小白鞋,夏季拖鞋,夏季凉鞋,休闲女鞋" data-link-type="2" data-link-seq="14,17,18,52" tapmode onclick="openAllShoesList(this)"/>
                <img src="https://www.fyweather.com/SmartSale/picture\ueditor\4\image\a90955b4_88b9_4318_84fe_53ff06ec62b3.jpg" width="50%" height="auto" style="" title="a90955b4_88b9_4318_84fe_53ff06ec62b3.jpg"/>
                <img src="https://www.fyweather.com/SmartSale/picture\ueditor\4\image\831f0f97_964d_449c_9915_e9f70c9d4750.jpg" width="50%" height="auto" style="" title="小白鞋" data-link-type="2" data-link-seq="14" tapmode onclick="openAllShoesList(this)"/>
                <img src="https://www.fyweather.com/SmartSale/picture\ueditor\4\image\e1e1e10d_f5f8_42eb_b3de_3b7f4173a4bf.jpg" width="50%" height="auto" style="" title="e1e1e10d_f5f8_42eb_b3de_3b7f4173a4bf.jpg"/>
                <img src="https://www.fyweather.com/SmartSale/picture\ueditor\4\image\3c3cf6c5_13ff_436a_9e40_75a7766c9760.jpg" width="50%" height="auto" style="" title="3c3cf6c5_13ff_436a_9e40_75a7766c9760.jpg"/>-->
    </section>
    <div class="top aui-hide">
        <img id="topArrow" src="../image/back_top.png" />
    </div>
    <footer class="footer-over aui-card-list-footer aui-text-center aui-font-size-12 aui-hide">
        到底了<i class="aui-iconfont aui-icon-activity aui-font-size-12"></i>
    </footer>
    <footer class="footer-more aui-card-list-footer aui-text-center aui-font-size-12 aui-hide">
        加载更多<i class="aui-iconfont aui-icon-more aui-font-size-12"></i>
    </footer>
    </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common/common.js"></script>
<script type="text/javascript" src="../script/common/visitor_tips.js"></script>
<script type="text/javascript" src="../script/common/jquery_min.js"></script>
<script type="text/javascript" src="../script/common/swiper_min.js"></script>
<script type="text/javascript" src="../script/aui2x1/aui_toast.js"></script>
<script type="text/javascript" src="../script/aui2x1/aui_slide.js"></script>
<script type="text/javascript" src="../script/aui2x1/aui_lazyload.js"></script>
<script type="text/javascript" src="../script/modules.js"></script>
<script type="text/javascript">
    function toReplenishment() {
        if (_isObjectNull(userInfo)) {
            visitorAlert("");
        } else {
            _openWin('replenishment_list_win', 'replenishment/replenishment_list_win.html');
        }
    }

    function openShoppingGuideWin() {
        if (_isObjectNull(userInfo)) {
            visitorAlert("");
        } else {
            if (userInfo.factoryUserFlag) {
                var pageParam = {
                    flag: "shopping-guide",
                    shopSeqList: []
                }
                console.log('pageParam:' + $api.jsonToStr(pageParam));
                api.openDrawerLayout({
                    name: "shopping_guide_win",
                    url: "shopping/shopping_guide_win.html",
                    pageParam: pageParam,
                    animation: {
                        type: 'push'
                    },
                    softInputMode: "resize",
                    softInputBarEnabled: false,
                    overScrollMode: "always",
                    slidToOpenPane: false,
                    slidToClosePane: false,
                    rightPane: {
                        edge: 60,
                        pageParam: pageParam,
                        softInputMode: "resize",
                        softInputBarEnabled: false,
                        name: 'filter_win',
                        url: 'filter_win.html'
                    }
                });
            } else {
                _openWin("guider_list_win", "shopping/guider_list_win.html");
            }
        }
    }

    function openCategoryWin() {
        _openWin("category_win", "category_win.html");
    }

    function openSaleTargetWin() {
        if (_isObjectNull(userInfo)) {
            visitorAlert("");
        } else {
            if (userInfo.factoryUserFlag) {
                _openWin('sale_allindicator_win', 'sale/sale_allindicator_win.html');
            } else {
                var pageParam = {
                    shopName: userInfo.shopName,
                    month: new Date().getMonth() + 1,
                    shopSeq: userInfo.shopSeq,
                }
                _openWin('sale_indicator_win', 'sale/sale_indicator_win.html', pageParam);
            }
        }
    }

    function openSearchWin() {
        if (_isObjectNull(userInfo)) {
            visitorAlert("");
        } else {
            var animation = {
                type: "fade", //动画类型（详见动画类型常量）
                subType: "from_right", //动画子类型（详见动画子类型常量）
                duration: 300 //动画过渡时间，默认300毫秒
            };
            // var shoesCategoryList = $api.getStorage('shoesCategoryKey');
            // var categorySeqList = [];
            // for (var i = 0; i < shoesCategoryList.length; i++) {
            //     categorySeqList.push(shoesCategoryList[i].seq);
            // }
            var thisYear = new Date().getFullYear();
            var yearList = [];
            yearList.push(thisYear - 1);
            yearList.push(thisYear);
            var pageParam = {
                searchType: 'tab_content_1',
                flag: "goodsList",
                rangeType: 0,
                dataType: 0,
                name: '搜索列表',
                yearList: [],
                seasonSeqList: [],
                supplement: '',
                // categorySeqList: categorySeqList,
                categorySeqList: [],
                cateSeqList: [],
                colorSeqList: [],
                sXMap: "",
                fuzzySearchParam: "",
                sizeType: "",
                sizeSeqStart: "",
                sizeSeqEnd: "",
                orderBy: 1,
                orderDir: 0,
                timeRange: "30",
                saleTimeStart: "2017/01/02",
                saleTimeEnd: _getFormatedDate("", "yyyy/MM/dd"),
                // saleTimeStart: "",
                // saleTimeEnd: "",
            };
            console.log('pageParam:' + $api.jsonToStr(pageParam));
            _openWin('search_win', 'search/search_win.html', pageParam, false, true, animation);
        }
    }

    /*
     *打开二维码扫描器
     */
    function openScanner() {
        FNScanner.open({
            autorotation: false, // 描述:可选项, 扫描页面是否自动旋转(横竖屏默认值：false)
            encoding: 1,
            hintText: "对准货品货号生成的二维码，扫码找货",
            isAlbum: true,
        }, function(ret, err) {
            if (ret) {
                console.log(JSON.stringify(ret));
                //1. eventType: 'cancel',   //字符串类型；扫码事件类型:show（模块显示）  cameraError（访问摄像头失败）   albumError（访问相册失败）  cancel（用户取消扫码）     selectImage（用户从系统相册选取二维码图片）    success（识别二维码/条码图片成功）   7.fail（扫码失败）
                //2. imgPath: '',       //字符串类型；需要保存的二维码图片绝对路径（自定义路径）
                //3. albumPath: '',     //字符串类型；需要保存的二维码图片绝对路径（相册路径）
                //4. content: ''        //扫描的二维码/条形码信息
                if (ret.eventType == "cameraError") {
                    _toast("访问摄像头失败", 3000, "bottom", function() {});
                } else if (ret.eventType == "fail") {
                    _toast("扫码失败", 3000, "bottom", function() {});
                } else if (ret.eventType == "success") {
                    console.log("扫描到鞋子货号:" + ret.content);
                    var url = window.myServerUrl + "order/app/goodsData/getGoodsViewByGoodId?goodId=" + $api.trim(ret.content);
                    console.log("通过扫码获取商品详情:" + url);
                    _ajax(url, '通过扫码获取商品详情', function(ret, err) {
                        if (ret) {
                            console.log($api.jsonToStr(ret));
                            if (ret.code == 0) {
                                if (!_isStringNull(ret.result.result)) {
                                    toGoodsDetailWin(ret.result.result);
                                } else {
                                    _toast("扫描结果与鞋子信息不匹配", 3000, "bottom", function() {});
                                }
                            } else {
                                _toast("扫描结果与鞋子信息不匹配", 3000, "bottom", function() {});
                            }
                        } else {
                            _toast(window.ajaxErrorMessage);
                        }
                    });
                    // var allGoodIdData = $api.getStorage("allGoodIdKey"); //用户可查看的所有鞋子货号
                    // console.log("该用户所有鞋子货号为:" + $api.jsonToStr(allGoodIdData));
                    // if (!_isArrayNull(allGoodIdData)) {
                    //     var isMatch = false; //扫描值是否与鞋子货号匹配
                    //     var seq, goodId; //匹配成功的鞋子序号和货号
                    //     for (var i = 0; i < allGoodIdData.length; i++) {
                    //         if ($api.trim(allGoodIdData[i].goodId) == ret.content) { //根据扫描出的值, 匹配鞋子货号
                    //             seq = allGoodIdData[i].seq;
                    //             goodId = allGoodIdData[i].goodId;
                    //             isMatch = true;
                    //             break;
                    //         }
                    //     }
                    //     if (isMatch) {
                    //         toGoodsDetailWin(seq, goodId, true);
                    //     } else {
                    //         _toast("扫描结果与鞋子信息不匹配", 3000, "bottom", function() {});
                    //     }
                    // } else {
                    //     _toast("此用户暂无鞋子数据", 3000, "bottom", function() {});
                    // }
                }
            } else {
                console.log(JSON.stringify(err));
            }
        });
    }

    function toSaleAnalysis() {
        var now = new Date().setDate(1);
        if (_isObjectNull(userInfo)) {
            visitorAlert("");
        } else {
            var shoesCategoryList = $api.getStorage('shoesCategoryKey');
            var categorySeqList = [];
            for (var i = 0; i < shoesCategoryList.length; i++) {
                categorySeqList.push(shoesCategoryList[i].seq);
            }
            var thisYear = new Date().getFullYear();
            var yearList = [];
            yearList.push(thisYear - 1);
            yearList.push(thisYear);
            console.log(now);
            console.log(new Date().getDate());
            if (new Date().getDate() == 1) {
                var pageParam = {
                    flag: "saleAnalysis",
                    // rangeType: "",
                    // dataType: "",
                    // categorySeq: "",
                    // name: "",
                    shopSeqList: userInfo.factoryUserFlag ? [] : [userInfo.shopSeq],
                    oldOrNew: '',
                    startPrice: '',
                    endPrice: '',
                    // shopSeq: _isStringNull(userInfo.shopSeq) ? "" : userInfo.shopSeq,
                    // shopName: _isStringNull(userInfo.shopName) ? "总部" : userInfo.shopName,
                    yearList: [],
                    seasonSeqList: [],
                    categorySeqList: [],
                    colorSeqList: [],
                    sXMap: "",
                    type: '1',
                    // fuzzySearchParam: "",
                    // sizeType: "",
                    // sizeSeqStart: "",
                    // sizeSeqEnd: "",
                    cateSeqList: [],
                    orderBy: 1,
                    orderDir: 0,
                    timeRange: "0",
                    saleTimeStart: _getFormatedDate(new Date().setDate(1), "yyyy/MM/dd"),
                    saleTimeEnd: _getFormatedDate(new Date().setDate(1), "yyyy/MM/dd"),
                    // saleTimeStart: "",
                    // saleTimeEnd: "",
                };
            } else {
                var pageParam = {
                    flag: "saleAnalysis",
                    // rangeType: "",
                    // dataType: "",
                    // categorySeq: "",
                    // name: "",
                    shopSeqList: userInfo.factoryUserFlag ? [] : [userInfo.shopSeq],
                    oldOrNew: '',
                    startPrice: '',
                    endPrice: '',
                    // shopSeq: _isStringNull(userInfo.shopSeq) ? "" : userInfo.shopSeq,
                    // shopName: _isStringNull(userInfo.shopName) ? "总部" : userInfo.shopName,
                    yearList: [],
                    seasonSeqList: [],
                    categorySeqList: [],
                    colorSeqList: [],
                    sXMap: "",
                    type: '1',
                    // fuzzySearchParam: "",
                    // sizeType: "",
                    // sizeSeqStart: "",
                    // sizeSeqEnd: "",
                    cateSeqList: [],
                    orderBy: 1,
                    orderDir: 0,
                    timeRange: "0",
                    saleTimeStart: _getFormatedDate(now, "yyyy/MM/dd"),
                    saleTimeEnd: _getFormatedDate("", "yyyy/MM/dd"),
                    // saleTimeStart: "",
                    // saleTimeEnd: "",
                };
            }
            console.log('pageParam:' + $api.jsonToStr(pageParam));
            api.openDrawerLayout({
                name: "sale_analysis_win",
                url: "sale/sale_analysis_win.html",
                pageParam: pageParam,
                animation: {
                    type: 'push'
                },
                softInputMode: "resize",
                softInputBarEnabled: false,
                overScrollMode: "always",
                slidToOpenPane: false,
                slidToClosePane: false,
                rightPane: {
                    edge: 60,
                    pageParam: pageParam,
                    softInputMode: "resize",
                    softInputBarEnabled: false,
                    name: 'filter_win',
                    url: 'filter_win.html'
                }
            });
        }
    }

    function toDevelopingWin(_name) {
        var pageParam = {
            name: _name
        }
        _openWin('developwin', 'goods/developing_win.html', pageParam);
    }

    /*
     *打开商品列表界面
     *_rangeType：0公司 ，1本店
     *_dataType：0全部货品 ，1新品推荐 ，2主推款
     *_categorySeqList：默认为-1，否则为分类seq,多个以逗号隔开
     *_name：名称
     */
    function toGoodsListWin(_rangeType, _dataType, _categorySeqs, _name) {
        nearSeasonList = $api.getStorage('TwoNearSeasonListKey');
        var shoesCategoryList = $api.getStorage('shoesCategoryKey');
        if (_isObjectNull(userInfo)) {
            visitorAlert("");
        } else {
            var thisYear = new Date().getFullYear();
            var yearListKey = $api.getStorage('yearListKey');
            var allYearList = [];
            for (var i = 0; i < yearListKey.length; i++) {
                if (yearListKey[i] >= thisYear) {
                    continue;
                } else {
                    allYearList.push(yearListKey[i]);
                }
            }
            var yearList = [];
            var saleType;
            yearList.push(thisYear - 1);
            yearList.push(thisYear);
            var pageParam = {
                flag: "goodsList",
                rangeType: _rangeType,
                dataType: _dataType,
                name: _name,
                seasonSeqList: [],
                supplement: '',
                categorySeqList: _categorySeqs != -1 ? _categorySeqs.split(",") : [],
                colorSeqList: [],
                cateSeqList: [],
                sXMap: "",
                fuzzySearchParam: "",
                sizeType: "",
                sizeSeqStart: "",
                sizeSeqEnd: "",
                orderBy: 1,
                orderDir: 0,
                saleTimeStart: "2017/01/02",
                saleTimeEnd: _getFormatedDate("", "yyyy/MM/dd"),
                stockMinNum: "",
                stockMaxNum: "",
            };
            if (_name == '全部货品') {
                pageParam.yearList = [];
                pageParam.timeRange = "30";
                pageParam.shopSeqList = [];
            } else if (_name == '畅销款' || _name == '滞销款') {
                pageParam.yearList = [thisYear];
                pageParam.timeRange = "7";
                pageParam.ranking = "1";
                pageParam.supplement = "";
                pageParam.saleType = _name == '畅销款' ? '1' : '0';
                pageParam.shopSeqList = userInfo.factoryUserFlag ? [] : [userInfo.shopSeq];
                if (_name == '滞销款') {
                    pageParam.seasonSeqList = nearSeasonList;
                    pageParam.orderBy = 3;
                }
            } else if (_name == '老款') {
                pageParam.seasonSeqList = nearSeasonList;
                pageParam.yearList = allYearList;
                pageParam.timeRange = "30";
                pageParam.supplement = "";
                pageParam.shopSeqList = userInfo.factoryUserFlag ? [] : [userInfo.shopSeq];
            } else if (_name == '断缺码') {
                pageParam.yearList = [thisYear];
                pageParam.timeRange = "30";
                pageParam.supplement = "";
                pageParam.shopSeqList = userInfo.factoryUserFlag ? [] : [userInfo.shopSeq];
            } else if (_name == '主推款') {
                pageParam.timeRange = "7";
                pageParam.supplement = "";
                pageParam.shopSeqList = userInfo.factoryUserFlag ? [] : [userInfo.shopSeq];
            } else if (_name == '调配仓') {
                pageParam.yearList = [thisYear];
                pageParam.timeRange = "7";
                pageParam.shopSeqList = [];
                pageParam.isTransferOut = 0;
            } else if (_name == '存销比') {
                pageParam.yearList = [thisYear];
                pageParam.timeRange = "30";
                pageParam.cateSeqList = [];
                pageParam.supplement = "";
                pageParam.shopSeqList = userInfo.factoryUserFlag ? [] : [userInfo.shopSeq];
            } else if (_name == '总仓货品') {
              pageParam.rangeType =  "2";
              pageParam.timeRange = "30";
              pageParam.yearList = [];
              pageParam.supplement = "";
              pageParam.shopSeqList = [];
            } else {
                pageParam.timeRange = "30";
                pageParam.yearList = [];
                pageParam.supplement = "";
                pageParam.shopSeqList = userInfo.factoryUserFlag ? [] : [userInfo.shopSeq];
            }
            console.log('pageParam:' + $api.jsonToStr(pageParam));
            if (_name == '库存结构') {
                api.openDrawerLayout({
                    name: "goods_inventory_structure_win",
                    url: "goods/goods_inventory_structure_win.html",
                    pageParam: pageParam,
                    animation: {
                        type: 'push'
                    },
                    softInputMode: "resize",
                    softInputBarEnabled: false,
                    overScrollMode: "always",
                    slidToOpenPane: false,
                    slidToClosePane: false,
                    rightPane: {
                        edge: 60,
                        pageParam: pageParam,
                        softInputMode: "resize",
                        softInputBarEnabled: false,
                        name: 'filter_win',
                        url: 'filter_win.html'
                    }
                });
            } else if (_name == '存销比') {

                api.openDrawerLayout({
                    name: "goods_sellandinventory_win",
                    url: "goods/goods_sellandinventory_win.html",
                    pageParam: pageParam,
                    animation: {
                        type: 'push'
                    },
                    softInputMode: "resize",
                    softInputBarEnabled: false,
                    overScrollMode: "always",
                    slidToOpenPane: false,
                    slidToClosePane: false,
                    rightPane: {
                        edge: 60,
                        pageParam: pageParam,
                        softInputMode: "resize",
                        softInputBarEnabled: false,
                        name: 'filter_win',
                        url: 'filter_win.html'
                    }
                });
            } else {
                api.openDrawerLayout({
                    name: "list_win",
                    url: "goods/goods_list_win.html",
                    pageParam: pageParam,
                    animation: {
                        type: 'push'
                    },
                    softInputMode: "resize",
                    softInputBarEnabled: false,
                    overScrollMode: "always",
                    slidToOpenPane: false,
                    slidToClosePane: false,
                    rightPane: {
                        edge: 60,
                        pageParam: pageParam,
                        softInputMode: "resize",
                        softInputBarEnabled: false,
                        name: 'filter_win',
                        url: 'filter_win.html'
                    }
                });
            }
        }
    }

    //4.打开"扫码订"页面
    function openOrderMetting() {
        if (_isObjectNull(userInfo)) {
            visitorAlert("");
        } else {
            //跳转至订货计划页面,打开侧滑式布局
            var selectedSeasonList = $api.getStorage('seasonListKey');
            var seasonSeqList = [];
            for (var i = 0; i < selectedSeasonList.length; i++) {
                seasonSeqList.push(selectedSeasonList[i].seq);
            }
            var thisYear = new Date().getFullYear();
            var yearList = [];
            yearList.push(thisYear - 2);
            yearList.push(thisYear - 1);
            yearList.push(thisYear);
            yearList.push(thisYear + 1);
            var pageParam = {
                flag: "ordermetting",
                rangeType: "",
                dataType: "",
                name: "",
                yearList: [yearList[yearList.length - 1]],
                seasonSeqList: [seasonSeqList[0]],
                categorySeqList: [],
                colorSeqList: [],
                sXMap: "",
                fuzzySearchParam: "",
                sizeType: "",
                sizeSeqStart: "",
                sizeSeqEnd: "",
                orderBy: 1,
                orderDir: 0,
                timeRange: "30",
                saleTimeStart: "2017/01/02",
                saleTimeEnd: _getFormatedDate("", "yyyy/MM/dd"),
                // saleTimeStart: "",
                // saleTimeEnd: "",
            };
            console.log('pageParam:' + $api.jsonToStr(pageParam));
            api.openDrawerLayout({
                name: 'order_metting_win',
                url: 'ordermetting/order_metting_win.html',
                pageParam: pageParam,
                animation: {
                    type: 'push'
                },
                softInputMode: "resize",
                softInputBarEnabled: false,
                overScrollMode: "always",
                slidToOpenPane: false,
                slidToClosePane: false,
                rightPane: {
                    edge: 60, // 侧滑打开后，漏出的半透明区域宽度，默认值为60。此时侧滑window的宽度为屏幕宽度减去edge
                    name: 'filter_win', // window名字（字符串类型）
                    url: 'filter_win.html', // 页面地址，可以为本地文件路径，支持相对路径和绝对路径，以及widget://、fs://等协议路径，也可以为远程地址
                    pageParam: pageParam, //（可选项）页面参数，页面中可以通过api.pageParam获取，JSON对象
                    bgColor: '', //（可选项）背景色，支持图片和颜色，格式为#fff、#ffffff、rgba(r,g,b,a)等，图片路径支持fs://、widget://等APICloud自定义文件路径协议，同时支持相对路径
                    bounces: false, //（可选项）是否弹动，默认值：若在 config.xml 里面配置了pageBounce，则默认值为配置的值，否则为false
                    scrollToTop: false, //（可选项）当点击状态栏，页面是否滚动到顶部。若当前屏幕上不止一个页面的scrollToTop属性为true，则所有的都不会起作用。默认值：true。只iOS有效
                    scrollEnabled: true, //（可选项）页面内容超出后是否可以滚动，默认为true，只支持iOS
                    vScrollBarEnabled: false, //（可选项）是否显示垂直滚动条，默认true
                    hScrollBarEnabled: false, //（可选项）是否显示水平滚动条，默认true
                    scaleEnabled: false, //（可选项）页面是否可以缩放，布尔型，默认值：false
                    allowEdit: false, //（可选项）是否允许长按页面时弹出选择菜单
                    softInputMode: 'auto', //（可选项）当键盘弹出时，输入框被盖住时，当前页面的调整方式，只iOS有效    取值范围：resize(若键盘盖住输入框，页面会自动上移), pan (若键盘盖住输入框，页面不会自动上移), auto(默认值，由系统决定如何处理，iOS平台该字段等同于resize)
                    softInputBarEnabled: false, //（可选项）是否显示键盘上方的工具条，布尔型，默认值：true，只iOS有效
                    customRefreshHeader: '' //（可选项）设置使用自定义下拉刷新模块的名称，设置后可以使用api.setCustomRefreshHeaderInfo方法来使用自定义下拉刷新组件
                },
            });

        }
    }

    //渲染角标数量(订单, 消息)
    function renderDot(_elementId, _notifiNum) {
        //			alert(typeof(_notifiNum)+":"+_notifiNum);
        if (parseInt(_notifiNum) == 0) {
            if (!$api.hasCls($api.byId(_elementId), "aui-hide")) {
                $api.addCls($api.byId(_elementId), "aui-hide");
            }
        } else {
            if ($api.hasCls($api.byId(_elementId), "aui-hide")) {
                $api.removeCls($api.byId(_elementId), "aui-hide");
            }
            $api.text($api.byId(_elementId), _notifiNum);
        }
    }

    /* 跳转"商品详情"页面, 参数isSearch:是否搜索(0:不是, 1:是) */
    function toGoodsDetailWin(_seq) {
        var pageParam = {
            seq: _seq,
            isSearch: 0,
            timeRange: '30',
        };
        api.openDrawerLayout({
            name: "goods_detail_win",
            url: "goods/detail/goods_detail_win.html",
            pageParam: pageParam,
            animation: {
                type: "push", //动画类型（详见动画类型常量）
                subType: "from_right", //动画子类型（详见动画子类型常量）
                duration: 300 //动画过渡时间，默认300毫秒
            },
            softInputMode: "resize",
            softInputBarEnabled: false,
            overScrollMode: "always",
            slidToOpenPane: false,
            slidToClosePane: false,
            rightPane: {
                edge: 60,
                pageParam: pageParam,
                softInputMode: "resize",
                softInputBarEnabled: false,
                name: 'filter_sale_graph_win',
                url: 'goods/detail/filter_sale_graph_win.html'
            }
        });
    }

    /**
     *获取"厂家推荐" HTML
     */
    function getGoodsHTML(data) {
        var htmlStr = "";
        for (var i = 0; i < data.length; i++) {
            var priceParts = _isStringNull(data[i].dealPrice) ? ["0", "0"] : data[i].dealPrice.toFixed(1).split(".");
            //组织htmlStr
            if ((i + 1) % 2 != 0) {
                //奇数
                htmlStr += '<div class="aui-col-xs-6 aui-bg-white aui-margin-r-10 aui-margin-t-10" tapmode onclick="toGoodsDetailWin(' + data[i].seq + ')">';
            } else {
                //偶数
                htmlStr += '<div class="aui-col-xs-6 aui-bg-white aui-margin-t-10" tapmode onclick="toGoodsDetailWin(' + data[i].seq + ')">';
            }
            htmlStr += '<div class="contain">';
            htmlStr += '<div class="item"><div class="box"><img src="../../image/load_img_middle.png" data-src="' + data[i].img + '" /></div></div>';
            htmlStr += '</div>';
            htmlStr += '<div class="goods-title-2 aui-padded-l-10 aui-padded-r-10 aui-text-left aui-margin-b-5">' + data[i].goodId + '</div>';
            htmlStr += '<div class="goods-attr flex-wrap aui-text-left aui-text-theme aui-padded-l-10 aui-margin-b-5">';
            //采购价, 包括:1.oemPrice(贴牌商价格), 2.wholesalerPrice(批发商价格), 3.storePrice(直营店价格)
            htmlStr += '<div class="flex-2 ">平均成交价:<span class="aui-text-danger"><span>￥</span><span class="aui-font-size-16">' + priceParts[0] + '</span><span>.' + priceParts[1] + '</span></span></div>';
            htmlStr += '</div>';
            htmlStr += '<div class="goods-attr flex-wrap aui-text-left aui-padded-l-10 aui-margin-b-5">';
            htmlStr += '<div class="flex-6 "><span>日均销量:</span><span>' + data[i].salesDayAvg.toFixed(1) + '</span></div>';
            if (!_isStringNull(data[i].score)) {

                htmlStr += '<div class="flex-6 "><span>评分:</span><span class="data-score">' + data[i].score.toFixed(1) + '分</span></div>';
            }
            htmlStr += '</div>';
            htmlStr += '<div class="goods-attr flex-wrap aui-text-left aui-padded-l-10 aui-margin-b-5">';
            htmlStr += '<div class="flex-6 "><span>累计销量:</span><span>' + _getShortNum(data[i].salesNum) + '</span></div>';
            htmlStr += '<div class="flex-6 "><span>总库存:</span><span>' + _getShortNum(data[i].stock) + '</span></div>';
            htmlStr += '</div>';
            htmlStr += '</div>';
        }
        // console.log("htmlStr:" + htmlStr);
        return htmlStr;
    }

    /* 显示布局(参数1:隐藏的布局, 参数2:显示的布局) */
    function showLayout(_hide, _show) {
        if (!$api.hasCls($api.dom(".layout-" + _hide), "aui-hide")) {
            $api.addCls($api.dom(".layout-" + _hide), "aui-hide");
        }
        if ($api.hasCls($api.dom(".layout-" + _show), "aui-hide")) {
            $api.removeCls($api.dom(".layout-" + _show), "aui-hide");
        }
    }

    /* 显示页脚提示(参数1:隐藏的页脚, 参数2:显示的页脚) */
    function showFooterTip(_hide, _show) {
        if (!$api.hasCls($api.dom(".footer-" + _hide), "aui-hide")) {
            $api.addCls($api.dom(".footer-" + _hide), "aui-hide");
        }
        if ($api.hasCls($api.dom(".footer-" + _show), "aui-hide")) {
            $api.removeCls($api.dom(".footer-" + _show), "aui-hide");
        }
    }

    function initUI(data, type) {
        switch (type) {
            case "down":
                if (_isArrayNull(data)) {
                    //第一页没数据，则将isAjaxing置为true，用户向上滑动就不会请求服务器获取后面页数的数据了
                    isAjaxing = true;
                    //显示"到底了"
                    showFooterTip("more", "over");
                } else {
                    var htmlStr = getGoodsHTML(data);
                    console.log(htmlStr);
                    $api.html($api.dom(".all-recommend .aui-grid"), htmlStr);
                    if (data.length != 0 && data.length < num) {
                        //第一页数据不够每页总数，则将isAjaxing置为true，用户向上滑动就不会请求服务器获取后面页数的数据了
                        isAjaxing = true;
                        //显示"到底了"
                        showFooterTip("more", "over");
                    } else {
                        //第一页数据等于每页总数，false，用户向上滑动就再次请求服务器获取后面页数的数据
                        isAjaxing = false;
                        //显示"加载更多"
                        showFooterTip("over", "more");
                    }
                }
                break;
            case "up":
                if (_isArrayNull(data)) {
                    //当前页没数据了，则将isAjaxing置为true，防止继续上滑频繁请求服务器
                    isAjaxing = true;
                    //显示"到底了"
                    showFooterTip("more", "over");
                } else {
                    var htmlStr = getGoodsHTML(data);
                    //						console.log(htmlStr);
                    $api.append($api.dom(".all-recommend .aui-grid"), htmlStr);
                    if (data.length != 0 && data.length < num) {
                        //新获取页数据不够每页总数，则将isAjaxing置为true，用户向上滑动就不会请求服务器获取后面页数的数据了
                        isAjaxing = true;
                        //显示"到底了"
                        showFooterTip("more", "over");
                    } else {
                        isAjaxing = false;
                        //显示"加载更多"
                        showFooterTip("over", "more");
                    }
                }
                break;
        }
        new auiLazyload({
            errorImage: "../image/error_img_middle.png"
        });
        api.parseTapmode();
    }

    /**
     *获取:未读推送消息数量
     */
    function unreadRecordNum(call) {
        unreadRecordList = [];
        var url = window.myServerUrl + "order/app/pushRecord/unreadRecordNum";
        var currentAjaxTag = "unreadRecordNum";
        var isRequesting = true;
        console.log("未读推送消息数量:" + url);
        _ajax(url, currentAjaxTag, function(ret, err) {
            isRequesting = false;
            api.hideProgress();
            console.log("ajax." + currentAjaxTag + ".ret:" + $api.jsonToStr(ret));
            if (ret) {
                if (ret.code == 0) {
                    unreadRecordList = ret.result;
                } else {
                    _toast("获取未读消息数量失败!");
                }
            } else {
                console.log("ajax." + currentAjaxTag + ".err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            call();
        });
    }

    /**
     *获取:鞋子分类
     */
    function getShoesCategory(call) {
        var url = window.myServerUrl + "order/app/seasonCategorySx/shoesCategory";
        console.log("获取鞋子分类-->url:" + url);
        _ajax(url, "shoesCategory", function(ret, err) {
            var shoesCategorys = [];
            if (ret) {
                console.log("获取鞋子分类-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    shoesCategorys = ret.result;
                } else {
                    _toast("未获取鞋子分类数据！");
                }
            } else {
                console.log("获取到鞋子分类-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            $api.setStorage("shoesCategoryKey", shoesCategorys);
            call();
        });
    }

    /**
     *获取:鞋子颜色
     */
    function getColorList(call) {
        var url = window.myServerUrl + "order/app/seasonCategorySx/colorList";
        console.log("获取鞋子颜色-->url:" + url);
        _ajax(url, "getColorList", function(ret, err) {
            var colorList = [];
            if (ret) {
                // console.log("获取鞋子颜色-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    colorList = ret.result;
                } else {
                    _toast("未获取到鞋子颜色数据！");
                }
            } else {
                console.log("获取鞋子颜色-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            $api.setStorage("colorListKey", colorList);
            call();
        });
    }
    /**
     *获取:货品年份
     */
    function getYearList(call) {
        var url = window.myServerUrl + "order/app/shoesInfo/selectYearList";
        console.log("获取货品年份-->url:" + url);
        _ajax(url, "getColorList", function(ret, err) {
            var yearList = [];
            if (ret) {
                console.log("获取货品年份-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    yearList = ret.result;
                } else {
                    _toast("未获取到货品年份数据！");
                }
            } else {
                console.log("获取货品年份-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            $api.setStorage("yearListKey", yearList);
            call();
        });
    }

    /**
     *获取:鞋子属性
     */
    function getShoesSXAndOptions(call) {
        var url = window.myServerUrl + "order/app/seasonCategorySx/shoesSXAndOptions";
        console.log("获取鞋子属性-->url:" + url);
        _ajax(url, "getShoesSXAndOptions", function(ret, err) {
            var shoesSXAndOptions = [];
            if (ret) {
                console.log("获取鞋子属性-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    shoesSXAndOptions = ret.result;
                } else {
                    _toast("未获取到鞋子属性数据！");
                }
            } else {
                console.log("获取鞋子属性-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            $api.setStorage("shoesSXAndOptionsKey", shoesSXAndOptions);
            call();
        });
    }

    /**
     *获取:获取所有尺码
     */
    function getAllSizes(call) {
        var url = window.myServerUrl + "order/app/shoesInfo/selectGoodsSize";
        console.log("获取所有尺码-->url:" + url);
        _ajax(url, "getAllSizes", function(ret, err) {
            var allSizes = [];
            if (ret) {
                console.log("获取所有尺码-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    allSizes = ret.result;
                } else {
                    _toast("未获取所有尺码数据！");
                }
            } else {
                console.log("获取所有尺码-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            $api.setStorage("allSizesKey", allSizes);
            call();
        });
    }

    /**
     *获取:获取所有门店
     */

    function getAllShops(call) {
        var url = window.myServerUrl + "order/app/goodIdAnalysis/getAllShops";
        console.log("获取所有门店-->url:" + url);
        _ajax(url, "getAllShops", function(ret, err) {
            var allShops = [];
            if (ret) {
                console.log("获取所有门店-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    allShops = ret.result;
                } else {
                    _toast("未获取所有门店数据！");
                }
            } else {
                console.log("获取所有门店-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            $api.setStorage("allShopsKey", allShops);
            call();
        });
    }


    /**
     *获取:Ueditor生成的已登录首页HTML
     *
     */
    function getHomePageHtml(call) {
        var url = window.myServerUrl + "order/app/editor/homePage";
        console.log("获取已登录首页HTML-->url:" + url);
        _ajax(url, "getHomePageHtml", function(ret, err) {
            if (ret) {
                console.log("获取已登录首页HTML-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    homePageHtml = decodeURIComponent(ret.result).replace(/&nbsp;/g, '');
                    console.log("获取已登录首页HTML-->homePageHtml:" + homePageHtml);
                }
            } else {
                console.log("获取已登录首页HTML-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            call();
        });
    }

    /**
     *获取:Ueditor生成的未登录展示HTML
     *
     */
    function getDefaultPageHtml(call) {
        var url = window.myServerUrl + "order/app/editor/defaultPage";
        console.log("获取未登录首页HTML-->url:" + url);
        _ajax(url, "getDefaultPageHtml", function(ret, err) {
            if (ret) {
                console.log("获取未登录首页HTML-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    homePageHtml = decodeURIComponent(ret.result).replace(/&nbsp;/g, '');
                    console.log("获取未登录首页HTML-->homePageHtml:" + homePageHtml);
                }
            } else {
                console.log("获取未登录首页HTML-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            call();
        });
    }

    /**
     *获取当前用户能查看的所有鞋子的相关信息,并放入缓存(如果缓存中已有, 则不会再执行该方法, 用户登出会清空)
     */
    function getAllGoodId(call) {
        var url = window.myServerUrl + "order/app/shoesInfo/getAllGoodIds";
        console.log("获取所有鞋子的货号-->url:" + url);
        _ajax(url, "getAllGoodIds", function(ret, err) {
            var result = [];
            if (ret) {
                console.log("获取所有鞋子的货号-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    result = ret.result;
                }
            } else {
                console.log("获取所有鞋子的货号-->err:" + $api.jsonToStr(ret));
                _toast(window.ajaxErrorMessage);
            }
            $api.setStorage("allGoodIdKey", result);
            call();
        });
    }

    /*
     *获取鞋子列表数据
     */
    function shoesList(_rangeType, _dataType, _num, call) {
        var url = '';
        if (_dataType == 2) {
            url += window.myServerUrl + "order/app/shoesInfo/selectMainPushShoes";
            if (userInfo.factoryUserFlag) {
                url += "?shopSeqList="
            } else {
                url += "?shopSeqList=" + userInfo.shopSeq
            }
            url += "&categorySeqList="; //分类 数据类型：Array[integer]
            url += "&orderBy=1"; //排序字段(1:销量 2:库存 3:售罄率 4:评分) 数据类型：integer
            url += "&orderDir=0"; //排序方式(0:降序 1:升序) 数据类型：integer
            url += "&start=1"; //起始条数 数据类型：integer
            url += "&num=10"; //总条数 数据类型：integer
            url += "&saleTimeStart=" + _getStartDateByNum('7'); //销售时间区间：起始时间 数据类型：date-time
            url += "&saleTimeEnd=" + _getFormatedDate("", "yyyy/MM/dd"); //销售时间区间：结束时间 数据类型：date-time
        } else if (_dataType == 1) {
            url += window.myServerUrl + "order/app/shoesInfo/shoesList";
            url += "?rangeType=0"; //范围（0:公司 1:本店）数据类型：integer
            url += "&dataType=1"; //类型（0:全部货品 1:新品推荐 2:主推款）数据类型：integer
            url += "&yearList="; //年份 数据类型：Array[integer]
            url += "&seasonSeqList="; //季节 数据类型：Array[integer]
            url += "&categorySeqList="; //分类 数据类型：Array[integer]
            url += "&colorSeqList="; //颜色 数据类型：Array[integer]
            url += "&sXMap="; //自定义属性 数据类型：string
            url += "&fuzzySearchParam="; //模糊查询条件（多个用空格隔开）【注意：仅在搜索商品时使用，不为空时，所有其他属性筛选条件失效】数据类型：string
            url += "&sizeType="; //尺码类型： 0:断码 1:缺码 2:自定义 数据类型：integer
            url += "&sizeSeqStart="; //尺码：起始 数据类型：integer
            url += "&sizeSeqEnd="; //尺码：结束 数据类型：integer
            url += "&orderBy=1"; //排序字段(1:销量 2:库存 3:售罄率 4:评分) 数据类型：integer
            url += "&orderDir=0"; //排序方式(0:降序 1:升序) 数据类型：integer
            // url += "&shopSeq=" + pageParam.shopList; //门店seq
            url += "&supplement="; //有无补单 (0:无补单 1:有补单)
            var shops = userInfo.factoryUserFlag ? [] : [userInfo.shopSeq]
            url += "&shopSeqList=" + shops; //店铺序号
            url += "&start=1"; //起始条数 数据类型：integer
            url += "&num=6"; //总条数 数据类型：integer
            url += "&stockMinNum="; //最小库存
            url += "&stockMaxNum="; //最大库存
            url += "&saleTimeStart=" + _getStartDateByNum('30'); //销售时间区间：起始时间 数据类型：date-time
            url += "&saleTimeEnd=" + _getFormatedDate("", "yyyy/MM/dd"); //销售时间区间：结束时间 数据类型：date-time
        }
        console.log("获取鞋子列表数据-->url:" + url);
        isAjaxing = true;
        _ajax(url, "shoesList", function(ret, err) {
            isAjaxing = false;
            var tempGoodsList = [];
            if (ret) {
                console.log("获取鞋子列表数据-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    tempGoodsList = ret.result;
                    //list数组

                } else {
                    _toast(ret.msg);
                }
            } else {
                console.log("获取鞋子列表数据-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            if (_dataType == 1) {
                newestDatas = tempGoodsList;
            } else if (_dataType == 0) {
                venderDatas = tempGoodsList;
                initUI(venderDatas, 'down')
            } else {
                recommendDatas = tempGoodsList;
            }



            call();
        });
    }
    /**
     *获取:轮播图+公告
     */
    function getImgMainUrl(call) {
        var url = window.myServerUrl + "order/app/homepage/carousel";
        console.log("获取轮播图+公告-->url:" + url);
        _ajax(url, "carousel", function(ret, err) {
            if (ret) {
                console.log("获取轮播图+公告-->ret:" + $api.jsonToStr(ret));
                if (ret.code == 0) {
                    carouselDatas = ret.result;
                } else {
                    _toast("获取轮播图失败！");
                }
            } else {
                console.log("获取轮播图-->err:" + $api.jsonToStr(err));
                _toast(window.ajaxErrorMessage);
            }
            call();
        });
    }

    /**
     *获取首页数据
     */
    function getHomeDatas() {
        carouselDatas = new Array();
        recommendDatas = new Array();
        newestDatas = new Array();
        homePageHtml = "";
        if (_isObjectNull(userInfo)) {
            //未登录,获取自定义html(后台Ueditor生成)
            getDefaultPageHtml(function() {
                showLayout("default", "custom"); //首页显示自定义布局
                if (!$api.hasCls($api.dom(".footer-over"), "aui-hide")) {
                    $api.addCls($api.dom(".footer-over"), "aui-hide");
                }
                if (!$api.hasCls($api.dom(".footer-more"), "aui-hide")) {
                    $api.addCls($api.dom(".footer-more"), "aui-hide");
                }
                $api.html($api.dom(".layout-custom"), homePageHtml);
                closeUILoading();
                api.refreshHeaderLoadDone();
                if ($api.hasCls($api.dom(".content"), "aui-hide")) {
                    $api.removeCls($api.dom(".content"), "aui-hide");
                }
            });
        } else {
            //获取轮播图
            getImgMainUrl(function() {
                // //获取自定义html(后台Ueditor生成)
                // getHomePageHtml(function() {
                if (_isStringNull(homePageHtml)) {
                    showLayout("custom", "default"); //首页显示默认布局
                    //获取新品推荐
                    var is_new_recommend_checked = $api.getStorage('new_recommend_key');
                    if (is_new_recommend_checked == 1) {
                        shoesList(0, 1, 6, function() {
                            //获取公司主推
                            var is_company_recommend_checked = $api.getStorage('company_recommend_key');
                            if (is_company_recommend_checked == 1) {
                                shoesList(0, 2, 6, function() {
                                    //获取全部货品
                                    var is_all_recommend_checked = $api.getStorage('all_recommend_key');
                                    if (is_all_recommend_checked == 1) {
                                        shoesList(0, 0, num, function() {
                                            // venderDatas = ret3;
                                            getOther();
                                        });
                                    } else {

                                        getOther();
                                    }
                                });
                            } else {
                                //获取全部货品
                                var is_all_recommend_checked = $api.getStorage('all_recommend_key');
                                if (is_all_recommend_checked == 1) {
                                    shoesList(0, 0, num, function() {
                                        getOther();
                                    });
                                } else {

                                    getOther();

                                }
                            }
                        });
                    } else {
                        //获取公司主推
                        var is_company_recommend_checked = $api.getStorage('company_recommend_key');
                        if (is_company_recommend_checked == 1) {

                            shoesList(0, 2, 6, function() {
                                //获取全部货品

                                var is_all_recommend_checked = $api.getStorage('all_recommend_key');
                                if (is_all_recommend_checked == 1) {
                                    shoesList(0, 0, num, function() {
                                        getOther();
                                    });
                                } else {

                                    getOther();
                                }
                            });
                        } else {
                            //获取全部货品
                            var is_all_recommend_checked = $api.getStorage('all_recommend_key');
                            if (is_all_recommend_checked == 1) {
                                shoesList(0, 0, num, function() {
                                    getOther();
                                });
                            } else {
                                getOther();
                            }
                        }
                    }
                } else {
                    showLayout("default", "custom"); //首页显示自定义布局
                    if (!$api.hasCls($api.dom(".footer-over"), "aui-hide")) {
                        $api.addCls($api.dom(".footer-over"), "aui-hide");
                    }
                    if (!$api.hasCls($api.dom(".footer-more"), "aui-hide")) {
                        $api.addCls($api.dom(".footer-more"), "aui-hide");
                    }
                    $api.html($api.dom(".layout-custom"), homePageHtml);
                    getOther();
                }
                // });
            });
        }
    }

    function getOther() {
        //获取商品分类列表
        getShoesCategory(function() {
            //获取所有属性
            getShoesSXAndOptions(function() {
                //获取所有颜色列表
                getColorList(function() {
                    //获取所有货品年份
                    getYearList(function() {


                        //获取所有尺码
                        getAllSizes(function() {
                            //获取所有门店
                            getAllShops(function() {
                                //获取未读推送消息数量
                                unreadRecordNum(function() {
                                    console.log("未读记录:" + $api.jsonToStr(unreadRecordList));
                                    if (_isArrayNull(unreadRecordList)) {
                                        orderUnreadMessageCount = 0;
                                        _sendEvent("systemUnreadMessageCountChangedEvent", {
                                            systemUnreadMessageCount: 0
                                        });
                                    } else {
                                        var _systemUnreadMessageCount = 0;
                                        for (var i = 0; i < unreadRecordList.length; i++) {
                                            _systemUnreadMessageCount += unreadRecordList[i].num;
                                            if (unreadRecordList[i].type == 1) {
                                                //订单类型的未读消息数
                                                orderUnreadMessageCount = unreadRecordList[i].num;
                                            }
                                        }
                                        //渲染角标(订单通知数量)
                                        _sendEvent("systemUnreadMessageCountChangedEvent", {
                                            systemUnreadMessageCount: _systemUnreadMessageCount
                                        });
                                    }
                                    //*************** 开始页面渲染 ***************
                                    api.refreshHeaderLoadDone();
                                    closeUILoading();
                                    var is_company_recommend_checked = $api.getStorage('company_recommend_key');
                                    var is_new_recommend_checked = $api.getStorage('new_recommend_key');
                                    var is_all_recommend_checked = $api.getStorage('all_recommend_key');
                                    if (is_company_recommend_checked == 1) {
                                        if ($api.hasCls($api.dom(".company-recommend"), "aui-hide")) {
                                            $api.removeCls($api.dom(".company-recommend"), "aui-hide");
                                        }
                                    } else {
                                        if (!$api.hasCls($api.dom(".company-recommend"), "aui-hide")) {
                                            $api.addCls($api.dom(".company-recommend"), "aui-hide");
                                        }
                                    }
                                    if (is_new_recommend_checked == 1) {
                                        if ($api.hasCls($api.dom(".new-recommend"), "aui-hide")) {
                                            $api.removeCls($api.dom(".new-recommend"), "aui-hide");
                                        }
                                    } else {
                                        if (!$api.hasCls($api.dom(".new-recommend"), "aui-hide")) {
                                            $api.addCls($api.dom(".new-recommend"), "aui-hide");
                                        }
                                    }
                                    if (is_all_recommend_checked == 1) {
                                        if ($api.hasCls($api.dom(".all-recommend"), "aui-hide")) {
                                            $api.removeCls($api.dom(".all-recommend"), "aui-hide");
                                        }
                                    } else {
                                        if (!$api.hasCls($api.dom(".all-recommend"), "aui-hide")) {
                                            $api.addCls($api.dom(".all-recommend"), "aui-hide");
                                        }
                                    }
                                    if ($api.hasCls($api.dom(".content"), "aui-hide")) {
                                        $api.removeCls($api.dom(".content"), "aui-hide");
                                    }
                                    //									var videoEles = $api.domAll("video");
                                    //									if(!_isArrayNull(videoEles)){
                                    //										muteVideo();//使视频播放器(可能多个)静音,防止用户厌烦
                                    //									}
                                    var imgMainHTML = "";
                                    if (!_isArrayNull(carouselDatas)) {
                                        for (var i = 0; i < carouselDatas.length; i++) {
                                            var linkSeq = carouselDatas[i].linkSeq ? carouselDatas[i].linkSeq : "";
                                            imgMainHTML += "<div class='aui-slide-node bg-dark' data-seq='" + carouselDatas[i].seq + "' data-title='" + carouselDatas[i].title +
                                                "' data-link-type='" +
                                                carouselDatas[i].type + "' data-link-seq='" +
                                                linkSeq +
                                                "' tapmode onclick='openAllShoesList(this)'>";
                                            imgMainHTML += "<img src='../image/load_nine_five' data-src='" + carouselDatas[i].image + "' />";
                                            imgMainHTML += "</div>";
                                        }
                                    } else {
                                        imgMainHTML += "<div class='aui-slide-node bg-dark' data-link-type='' data-link-seq='' tapmode onclick=''>";
                                        imgMainHTML += "<img src='../image/error_nine_five.png' />";
                                        imgMainHTML += "</div>";
                                    }
                                    console.log("首页轮播图HTML:" + imgMainHTML);
                                    $api.html($api.dom("#aui-slide1 .aui-slide-wrap"), imgMainHTML);
                                    new auiLazyload({
                                        errorImage: "../image/error_nine_five.png"
                                    });
                                    var slide1 = new auiSlide({
                                        container: $api.byId("aui-slide1"),
                                        // "width":300,
                                        "height": (api.frameWidth * 5) / 9,
                                        "speed": 300,
                                        "autoPlay": 0, //自动播放   0的话为手动滚动
                                        "pageShow": true,
                                        "loop": true,
                                        "pageStyle": 'dot',
                                        'dotPosition': 'center'
                                    }, function(_index) {});
                                    //initScrollPromptView();
                                    //渲染公司推荐UI
                                    if (!_isArrayNull(recommendDatas)) {
                                        $('.mainly-dom').removeClass('aui-hide')
                                            // var paths = [];
                                            // for (var i = 0; i < recommendDatas.length; i++) {
                                            // 		paths.push(recommendDatas[i].img);
                                            // }
                                            //	console.log("爆款图片路径paths:" + $api.jsonToStr(paths));
                                        var htmlStr = "";


                                        for (var i = 0; i < recommendDatas.length; i++) {

                                            // htmlStr += "<div class='aui-slide-node bg-dark' data-seq='" + recommendDatas[i].seq + "' tapmode onclick='toGoodsDetailWin(" + recommendDatas[i].seq +
                                            //     ");'>";
                                            // htmlStr += "<img src='../image/load_img.png' data-src='" + recommendDatas[i].img + "' />";
                                            // htmlStr += "</div>";
                                            htmlStr += "<div class='mainly-item swiper-slide' data-seq='" + recommendDatas[i].seq + "' tapmode onclick='toGoodsDetailWin(" + recommendDatas[i].seq +
                                                ");'>";
                                            htmlStr += "<img src='../image/load_img.png' data-src='" + recommendDatas[i].img + "' />";
                                            htmlStr += "<div class='mainly-title'>" + recommendDatas[i].goodId + "</div>";
                                            htmlStr += "<div class='flex-wrap'>";
                                            htmlStr += "<div class='flex-6 text-item'>";
                                            htmlStr += "总销量:" + recommendDatas[i].salesNum;
                                            htmlStr += "</div>";
                                            htmlStr += "<div class='flex-6 text-item'>";
                                            htmlStr += "总库存:" + recommendDatas[i].stock;
                                            htmlStr += "</div>";
                                            htmlStr += "</div>";
                                            htmlStr += "</div>";
                                        }
                                        //									console.log("htmlStr:" + htmlStr);
                                        $api.html($api.dom(".mainly-dom ul"), htmlStr);
                                        // $('.mainly-dom ul').css({
                                        //     'width': recommendDatas.length * 11 + 'rem'
                                        // })
                                        var swiper = new Swiper('.swiper-container', {
                                            slidesPerView: 1.5,
                                            spaceBetween: 30,
                                            pagination: {
                                                el: '.swiper-pagination',
                                                clickable: true,
                                            },
                                        });
                                        new auiLazyload({
                                            errorImage: "../image/error_img.png"
                                        });


                                        // var slide2 = new auiSlide({
                                        //     container: document.getElementById("aui-slide2"),
                                        //     // "width":300,
                                        //     "height": api.frameWidth * 0.75,
                                        //     "speed": 300, //轮播速度
                                        //     "autoPlay": 0, //自动播放
                                        //     "pageShow": true, //是否显示
                                        //     "loop": true, //是否循环 滚动
                                        //     "pageStyle": 'dot', //点风格显示
                                        //     'dotPosition': 'center' //点的位置
                                        // }, function(_index) {});
                                    } else {
                                        $('.mainly-dom').addClass('aui-hide')
                                    }
                                    //渲染新品推荐UI
                                    if (!_isArrayNull(newestDatas)) {
                                        var htmlStr = "";
                                        for (var i = 0; i < newestDatas.length; i++) {
                                            htmlStr += "<div class='aui-col-xs-4 box-wrap box-horizontal-center box-vertical-center' data-seq='" + newestDatas[i].seq +
                                                "' tapmode onclick='toGoodsDetailWin(" +
                                                newestDatas[i].seq + ")'>";
                                            htmlStr += "<img src='../image/load_small_img.png' data-src='" + newestDatas[i].img + "'/>";
                                            //								htmlStr += "<img src='../image/goods/B7132667C19.jpg'/>";
                                            htmlStr += "<div class='NO aui-hide'>";
                                            htmlStr += "NO." + (i + 1);
                                            htmlStr += "</div>";
                                            htmlStr += "</div>";
                                        }
                                        //							console.log("htmlStr:" + htmlStr);
                                        $api.html($api.dom(".new-recommend .aui-row"), htmlStr);
                                        new auiLazyload({
                                            errorImage: "../image/error_small_img.png"
                                        });
                                    }
                                    api.parseTapmode();
                                });
                            });
                        });
                    });


                });
            });
        });
    }

    //关闭声音
    function muteVideo() {
        //	    	alert("关闭声音");
        var myVideos = document.getElementsByTagName("video");
        for (var i = 0; i < myVideos.length; i++) {
            myVideos[i].muted = true;
        }
    }
    //暂停播放
    function pauseVideo() {
        //	    	alert("暂停播放");
        var myVideos = document.getElementsByTagName("video");
        for (var i = 0; i < myVideos.length; i++) {
            myVideos[i].pause();
        }
    }

    //开始播放
    function playVideo() {
        //	        alert("开始播放");
        var myVideos = document.getElementsByTagName("video");
        for (var i = 0; i < myVideos.length; i++) {
            myVideos[i].play();
        }
    }

    //点击首页轮播图片跳转商品列表或公告详情页面(seq为-1)
    function openAllShoesList(obj) {
        var linkType = $api.attr(obj, "data-link-type");
        var linkSeq = $api.attr(obj, "data-link-seq");
        var title = $api.attr(obj, "data-title");
        switch (linkType) {
            case "0":
                return;
                break;
            case "-1":
                //公告
                //TODO 进入公告详情界面
                var seq = $api.attr(obj, "data-seq");
                for (var i = 0; i < carouselDatas.length; i++) {
                    if (carouselDatas[i].type != -1) {
                        continue;
                    }
                    if (carouselDatas[i].seq == seq) {
                        var pageParam = {
                            title: carouselDatas[i].title,
                            content: carouselDatas[i].detailedPage,
                            time: "",
                        }
                        _openWin('notice_win', 'notice_win.html', pageParam)
                    }
                }
                break;
            case "1":
                //鞋子序号
                if (linkSeq.split(",").length > 1) {
                    //TODO 商品列表接口需要扩张下，支持获取指定多个商品seq的商品列表数据
                    toGoodsListWin("0", "0", "-1", '轮播推荐');
                } else {
                    toGoodsDetailWin(linkSeq); //跳转至商品详情页(linkSeq为单个鞋子序号)
                }
                break;
            case "2":
                //鞋子分类序号
                toGoodsListWin("0", "0", linkSeq, title);
                break;
        }
    }

    //获取购物车不重复货号集合(依赖于common.js)
    function getUniqueGoodIds(_arr) {
        var goodIdArr = []; //该订单商品的货号集合(元素不重复)
        for (var j = 0; j < _arr.length; j++) {
            goodIdArr.push(_arr[j].goodId);
        }
        goodIdArr = _unique(goodIdArr);
        return goodIdArr;
    }

    function closeUILoading() {
        UILoading.closeKeyFrame();
    }

    function openUILoading() {
        UILoading.keyFrame({
            rect: {
                w: 102,
                h: 102
            },
            styles: {
                bg: 'rgba(0,0,0,0)',
                corner: 5,
                interval: 50,
                frame: {
                    w: 102,
                    h: 102
                }
            },
            //				content : [{
            //					frame : 'widget://image/loading_more.gif' //字符串类型；加载状态动画的关键帧图片路径；
            //				}, {
            //					frame : 'widget://image/loading_more.gif' //字符串类型；加载状态动画的关键帧图片路径；
            //				}],
            mask: "rgba(255,0,0,0)"
        }, function(ret) {});
    }

    function itemClick(_obj) {
        var itemIndex = $api.attr(_obj, "data-index");
        var clickedItem = myModules[itemIndex];
        console.log("clickedItem:" + $api.jsonToStr(clickedItem));
        switch (clickedItem.itemName) {
            case "全部货品":
            case "本店货品":
            case "畅销款":
            case "滞销款":
            case "老款":
            case "主推款":
            case "库存结构":
            case "存销比":
            case "调配仓":
            case "断缺码":
            case "补货动态":
            case "总仓货品":
                toGoodsListWin(0, 0, '-1', clickedItem.itemName);
                break;
            case "会员管理":
            case "线上销售":
                toDevelopingWin(clickedItem.itemName);
                break;
            case "扫一扫":
                openScanner();
                break;
            case "搜索货品":
                openSearchWin();
                break;
            case "新品推荐":
                toGoodsListWin(0, '1', '-1', clickedItem.itemName);
                break;
                // case "补货动态":
                //     toReplenishment();
                //     break;
            case "订货会":
                openOrderMetting();
                break;
            case "人员管理":
                openShoppingGuideWin();
                break;
            case "销售指标":
                _openWin('sale_win', 'my/target/sale_win.html');
                break;
            case "销售分析":
                toSaleAnalysis();
                break;
            case "更多":
                _openWin('manage_win', 'manage_win.html');
                break;
            default:
                _toast("开发中,敬请期待~");
        }
    }

    function initModulesUI() {
        var myHtmlStr = "";
        console.log('myModules:'+$api.jsonToStr(myModules));
        for (var i = 0; i < myModules.length; i++) {
            var item = myModules[i];
            console.log('item:'+$api.jsonToStr(item));
            // alert($api.jsonToStr(item))
            if (myModules[i].itemName=='本店货品') {
              if (!_isObjectNull(userInfo)) {
                  if (userInfo.factoryUserFlag) {
                      continue;
                  }
              }
            }
            myHtmlStr += '<div class="aui-col-xs-3" data-index="' + i + '" tapmode onclick="itemClick(this)">';
            myHtmlStr += '<img src="../image/' + item.itemIcon + '" />';
            myHtmlStr += '<div class="aui-grid-label aui-font-size-12">';
            myHtmlStr += item.itemName;
            myHtmlStr += '</div>';
            myHtmlStr += '</div>';
        }
        // console.log("myHtmlStr:" + myHtmlStr);
        $api.html($api.dom(".my-grid .aui-row"), myHtmlStr);
    }

    function initMyModulesData() {
        myModules = [];
        var counter = 0;
        for (var i = 0; i < allModules.length; i++) {
            var group = allModules[i];
            var items = group.items;
            for (var j = 0; j < items.length; j++) {
                var item = items[j];
                if (item.itemName == '本店货品') {
                    if (!_isObjectNull(userInfo)) {
                        if (userInfo.factoryUserFlag) {
                            continue;
                        }
                    }
                }
                if (item.isDefault || item.isAdd) {
                    //是默认或者已添加
                    counter++;
                    if (counter > 100 && group.groupSeq != 999) {
                        continue;
                    }
                    item.groupSeq = group.groupSeq;
                    item.groupIndex = i;
                    item.ownIndex = j;
                    myModules.push(item);
                }
            }
        }
        $api.setStorage('myModulesKey', myModules);
    }

    function initData() {
        userInfo = $api.getStorage("userInfoKey");
        start = 1;
        num = 10;
        FNScanner = api.require('FNScanner');
        UILoading = api.require('UILoading');
        $api.css($api.dom(".poster-area"), "height:" + ((api.frameWidth * 5) / 9) + "px;");
        var modulesVersion = $api.getStorage("modulesVersionKey");
        modulesVersion = _isStringNull(modulesVersion) ? 0 : modulesVersion;
        if (modules.version != modulesVersion) {
            allModules = modules.datas;
            $api.setStorage('allModulesKey', allModules);
            $api.setStorage('modulesVersionKey', modules.version);
            initMyModulesData();
        } else {
            allModules = $api.getStorage("allModulesKey");
            if (_isObjectNull(allModules)) {
                allModules = modules.datas;
                $api.setStorage('allModulesKey', allModules);
            }
            myModules = $api.getStorage('myModulesKey');
            if (_isArrayNull(myModules)) {
                initMyModulesData();
            }
        }
        newAllModules = $api.strToJson($api.jsonToStr(allModules));
    }

    var userInfo;
    var UILoading;
    var FNScanner;
    var audioStreamer; //播放音频模块
    var carouselDatas = new Array(); //轮播图(最多5张)
    var recommendDatas = new Array(); //公司推荐
    var newestDatas = new Array(); //新品推荐图
    var homePageHtml = ""; //首页获取的html(后台ueditor生成)
    //厂家推荐数据集合
    var venderDatas = new Array();
    var isUserInfoUpdate = false;
    var isFirst = true;
    var start;
    var num;
    var currentVenderIndex = 0;
    var isAjaxing = false;
    var rongUnreadMessageCount = 0; //聊天消息数量
    var orderUnreadMessageCount = 0; //订单消息数量
    var unreadRecordList = [];
    var allModules;
    var newAllModules;
    var myModules;
    var nearSeasonList;
    apiready = function() {
        $api.fixStatusBar($api.dom("header"));
        api.parseTapmode();
        initData();
        initModulesUI();
        setTimeout(function() {
            openUILoading();
            getHomeDatas();
        }, 150);
        //下拉刷新
        api.setRefreshHeaderInfo({
            loadingImg: 'widget://image/loading_more.gif',
            bgColor: 'rgba(255,255,255,1)',
            textColor: '#505050',
            textDown: '下拉刷新...',
            textUp: '松开刷新...'
        }, function(ret, err) {
            //在这里从服务器加载数据，加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
            currentVenderIndex = 0;
            start = 1;
            venderDatas = [];
            unreadRecordList = [];
            getHomeDatas();
        });
        // //上拉加载
        // api.addEventListener({
        //     name: 'scrolltobottom',
        //     extra: {
        //         threshold: 0 //设置距离底部多少距离时触发，默认值为0，数字类型
        //     }
        // }, function(ret, err) {
        //     console.log("scrolltobottom.ret:" + $api.jsonToStr(ret));
        //     if (!isAjaxing) {
        //         start += num;
        //         console.log(start);
        //         //					console.log(homePageHtml);
        //         if (_isStringNull(homePageHtml)) {
        //             shoesList(0, 0, num, function(ret3) {
        //                 venderDatas = venderDatas.concat(ret3);
        //                 setTimeout(function() {
        //                     initUI(ret3, "up");
        //                 }, 100);
        //             });
        //         } else {
        //             if (!$api.hasCls($api.dom(".footer-over"), "aui-hide")) {
        //                 $api.addCls($api.dom(".footer-over"), "aui-hide");
        //             }
        //             if (!$api.hasCls($api.dom(".footer-more"), "aui-hide")) {
        //                 $api.addCls($api.dom(".footer-more"), "aui-hide");
        //             }
        //         }
        //     }
        // });
        //用户信息更改事件
        _addEventListener("userInfoUpdateKey", function(ret) {
            userInfo = $api.getStorage("userInfoKey");
            isUserInfoUpdate = true;
            initData();
            initModulesUI();
            api.refreshHeaderLoading();
        }, {});
        //接收重新获取未读消息数据广播
        _addEventListener("receivedPushMessageEvent", function(ret) {
            console.log("播放提示音" + $api.jsonToStr(ret));
            var _title = "订单通知";
            var _sound = "";
            if (ret.value.extra.type != "-1") {
                //订单通知
                if ((userInfo.attachType == 1 || userInfo.attachType == 4) && userInfo.saleType == 1) { //工厂方
                    _sound = 'widget://res/cj_' + ret.value.extra.type + '.mp3';
                } else {
                    if (parseInt(ret.value.extra.type) == 4 || parseInt(ret.value.extra.type) == 5) {
                        _sound = 'widget://res/sj_4-5.mp3';
                    } else if (parseInt(ret.value.extra.type) == 21 || parseInt(ret.value.extra.type) == 22 || parseInt(ret.value.extra.type) == 23) {
                        _sound = 'widget://res/sj_2.mp3';
                    } else {
                        _sound = 'widget://res/sj_' + ret.value.extra.type + '.mp3';
                    }
                }
            } else { //直播通知
                _title = "直播通知";
            }
            //弹出状态栏通知,带自定义提示音
            api.notification({
                notify: {
                    title: _title, //标题，Android中默认值为应用名称，支持Android和iOS 8.2以上系统
                    content: ret.value.content, //内容，默认值为'有新消息'
                    extra: ret.value.extra.type, //附加信息，页面可以监听noticeclicked事件得到点击的通知的附加信息
                    updateCurrent: false //是否覆盖更新已有的通知，取值范围true|false。只Android有效
                },
                sound: _sound
            }, function(ret, err) {
                var notifyId = ret.id; //通知id, 可用于取消状态栏通知
                console.log("收到-------->" + _title + _sound);
                if (_title = "订单通知") {
                    audioStreamer = api.require('audioStreamer');
                    audioStreamer.openPlayer({
                        path: _sound,
                    }, function(ret) {
                        if (ret.status) {}
                    });
                }
            });
            //未读推送消息数量
            unreadRecordNum(function() {
                api.refreshHeaderLoadDone();
                if (_isArrayNull(unreadRecordList)) {
                    orderUnreadMessageCount = 0;
                    _sendEvent("systemUnreadMessageCountChangedEvent", {
                        systemUnreadMessageCount: 0
                    });
                } else {
                    var _systemUnreadMessageCount = 0;
                    for (var i = 0; i < unreadRecordList.length; i++) {
                        _systemUnreadMessageCount += unreadRecordList[i].num;
                        if (unreadRecordList[i].type == 1) {
                            //订单类型的未读消息数
                            orderUnreadMessageCount = unreadRecordList[i].num;
                        }
                    }
                    _sendEvent("systemUnreadMessageCountChangedEvent", {
                        systemUnreadMessageCount: _systemUnreadMessageCount
                    });
                }
            });
        }, {});
        _addEventListener("rongUnreadMessageCountChangedEvent", function(ret) {
            console.log("未读消息数量改变事件      ret:" + $api.jsonToStr(ret));
            rongUnreadMessageCount = ret.value.rongUnreadMessageCount;
            //渲染角标(消息通知数量)
            renderDot("rongUnreadMessageCount", rongUnreadMessageCount);
        });
        //设置完首页展示设置
        _addEventListener("home_set_end_event", function(ret) {
            setTimeout(function() {
                //在这里从服务器加载数据，加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
                currentVenderIndex = 0;
                start = 1;
                venderDatas = [];
                unreadRecordList = [];
                api.refreshHeaderLoading();
            }, 200);
        });
        //应用从后台回到前台事件
        _addEventListener("resume", function(ret) {
            // setTimeout(function() {
            //     //					alert("resume");
            //     //在这里从服务器加载数据，加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
            //     currentVenderIndex = 0;
            //     start = 1;
            //     venderDatas = [];
            //     unreadRecordList = [];
            //     getHomeDatas();
            // }, 200);
        });
        //屏幕显示当前window事件
        _addEventListener("viewappear", function(ret) {
            // if (isUserInfoUpdate || isFirst) {
            //     setTimeout(function() {
            //         //						alert("viewappear");
            //         //在这里从服务器加载数据，加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
            //         currentVenderIndex = 0;
            //         start = 1;
            //         venderDatas = [];
            //         unreadRecordList = [];
            //         getHomeDatas();
            //         isUserInfoUpdate = false;
            //         isFirst = false;
            //     }, 200);
            // }
        });
        //返回顶部
        var topArrow = document.getElementById('topArrow');
        topArrow.onclick = function() {
            document.scrollTop = document.body.scrollTop = 0;
        };
        window.onscroll = function() {
            var sTop = document.documentElement.scrollTop || document.body.scrollTop;
            if (sTop >= api.frameHeight * 1.5) {
                //  console.log("显示按钮");
                if ($api.hasCls($api.dom(".top"), "aui-hide")) {
                    $api.removeCls($api.dom(".top"), "aui-hide");
                }
            } else {
                //   console.log("隐藏按钮");
                if (!$api.hasCls($api.dom(".top"), "aui-hide")) {
                    $api.addCls($api.dom(".top"), "aui-hide");
                }
            }
        };
        // "点击状态栏通知"事件监听
        api.addEventListener({
            name: 'noticeclicked'
        }, function(ret, err) {
            if (ret && ret.value) {
                console.log("noticeclicked->ret:" + $api.jsonToStr(ret));
                //订单通知:0~7, 直播通知:-1
                var type = ret.value;
                if (type == "-1") {
                    return;
                }
                //通过"点击通知"跳转消息页
                api.setTabBarAttr({
                    index: 1,
                });
            }
        });
        _addEventListener("myModulesChangedEvent", function() {
            allModules = $api.getStorage("allModulesKey");
            myModules = $api.getStorage('myModulesKey');
            console.log('myModules:' + $api.jsonToStr(myModules));
            initModulesUI();
        });
    };
</script>

</html>
